<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance | Donna'Log</title><meta name="author" content="Donna Tang"><meta name="copyright" content="Donna Tang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Constructor FunctionsWhat is a Constructor Function?A constructor function is simply a function that provides a template for creating objects and defines their basic structure. A single constructor fu">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance">
<meta property="og:url" content="https://donnapersonal.github.io/posts/jsbasic-prototype/">
<meta property="og:site_name" content="Donna&#39;Log">
<meta property="og:description" content="Constructor FunctionsWhat is a Constructor Function?A constructor function is simply a function that provides a template for creating objects and defines their basic structure. A single constructor fu">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.73ubpkycwk.webp">
<meta property="article:published_time" content="2021-07-09T01:10:53.000Z">
<meta property="article:modified_time" content="2025-10-03T01:48:08.690Z">
<meta property="article:author" content="Donna Tang">
<meta property="article:tag" content="JS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.73ubpkycwk.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance",
  "url": "https://donnapersonal.github.io/posts/jsbasic-prototype/",
  "image": "https://github.com/donnapersonal/picx-images-hosting/raw/master/image.73ubpkycwk.webp",
  "datePublished": "2021-07-09T01:10:53.000Z",
  "dateModified": "2025-10-03T01:48:08.690Z",
  "author": [
    {
      "@type": "Person",
      "name": "Donna Tang",
      "url": "https://donnapersonal.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://donnapersonal.github.io/posts/jsbasic-prototype/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":150,"languages":{"author":"Author: Donna Tang","link":"Link: ","source":"Source: Donna'Log","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://oss.012700.xyz/butterfly/2024/10/index.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Language</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-e"></i><span> English</span></a></li><li><a class="site-page child" href="/cn/"><i class="fa-fw fas fa-c"></i><span> Chinese</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Donna'Log</span></a><a class="nav-page-title" href="/"><span class="site-name">JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> Language</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-e"></i><span> English</span></a></li><li><a class="site-page child" href="/cn/"><i class="fa-fw fas fa-c"></i><span> Chinese</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance<a class="post-edit-link" href="null_posts/jsbasic-prototype.md" title="Edit" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-07-09T01:10:53.000Z" title="Created 2021-07-08 21:10:53">2021-07-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-03T01:48:08.690Z" title="Updated 2025-10-02 21:48:08">2025-10-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Frontend/">Frontend</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Frontend/JS/">JS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="Constructor-Functions"><a href="#Constructor-Functions" class="headerlink" title="Constructor Functions"></a>Constructor Functions</h1><h2 id="What-is-a-Constructor-Function"><a href="#What-is-a-Constructor-Function" class="headerlink" title="What is a Constructor Function?"></a>What is a Constructor Function?</h2><p>A <code>constructor function</code> is simply a function that <strong>provides a template for creating objects and defines their basic structure</strong>. A single <code>constructor function</code> can generate multiple objects, all of which share the same structure.</p>
<p>A <code>constructor function</code> is still just a function, but by convention, its name starts with a <code>capital letter</code>.</p>
<p>The difference between a <code>constructor function</code> and <code>a regular function</code> lies in how it is called:</p>
<ul>
<li>When called with the <code>new</code> keyword, it acts as a <code>constructor function</code> and <code>produces an instance</code>.</li>
<li>When called without <code>new</code>, it behaves as <code>a regular function</code>.</li>
</ul>
<p>When creating an object instance, the constructor must be invoked with the <code>new</code> keyword. Therefore, it is more accurate to <code>think of a constructor as a function invoked in construction mode</code>.</p>
<p>The <code>constructor property</code> returns <strong>a reference to the function that created the instance’s prototype</strong>. Its value is a reference to the function itself, not a string containing the function’s name.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">18</span>);</span><br><span class="line">p.<span class="property">constructor</span> === <span class="title class_">Person</span>; <span class="comment">// true</span></span><br><span class="line">p.<span class="property">constructor</span> === <span class="title class_">Object</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><strong>Does this mean that objects created by ordinary functions never have a constructor property?</strong> Not necessarily.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Regular function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">person</span>(<span class="params">age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="title function_">person</span>(<span class="number">20</span>); <span class="comment">// undefined</span></span><br><span class="line">p.<span class="property">constructor</span>; <span class="comment">// Cannot read property &#x27;constructor&#x27; of undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Regular function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">person</span>(<span class="params">age</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">age</span>: age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="title function_">person</span>(<span class="number">20</span>);</span><br><span class="line">p.<span class="property">constructor</span> === <span class="title class_">Object</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="Is-Symbol-a-Constructor"><a href="#Is-Symbol-a-Constructor" class="headerlink" title="Is Symbol a Constructor?"></a>Is Symbol a Constructor?</h2><p>According to <code>MDN</code>:</p>
<blockquote>
<p>The <code>Symbol()</code> function returns a value of type symbol. It has static properties that expose several members of built-in objects, and static methods that expose the global symbol registry. It resembles a built-in object class, but it is incomplete as a constructor because it does not support the syntax <code>new Symbol()</code>.</p>
</blockquote>
<ul>
<li><code>Symbol</code> is a <code>primitive data type</code>, but as a <code>constructor</code> it is considered incomplete, because it does not support the <code>new Symbol()</code> syntax. </li>
<li>Therefore, <strong><code>Symbol</code> is not treated as a constructor</strong>. To create a symbol value, you simply call <code>Symbol()</code> directly (per MDN).</li>
<li><strong>Each value returned from <code>Symbol()</code> is unique</strong>.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Symbol</span>(<span class="number">1</span>); <span class="comment">// Symbol is not a constructor </span></span><br><span class="line"><span class="title class_">Symbol</span>(<span class="number">1</span>); <span class="comment">// Symbol(1)</span></span><br></pre></td></tr></table></figure>

<p>Although <code>Symbol</code> is a primitive type, a value created with <code>Symbol(1)</code> can still access the constructor property:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="title class_">Symbol</span>(<span class="number">1</span>);  <span class="comment">// Symbol(1)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">constructor</span>); <span class="comment">// ƒ Symbol() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure>

<p>This constructor property actually comes from <code>Symbol.prototype</code>. </p>
<p>That is, <strong><code>Symbol.prototype.constructor</code> refers to the function that creates the prototype of the instance, which by default is the <code>Symbol</code> function itself</strong>.</p>
<h2 id="Is-the-constructor-Value-Read-Only"><a href="#Is-the-constructor-Value-Read-Only" class="headerlink" title="Is the constructor Value Read-Only?"></a>Is the constructor Value Read-Only?</h2><blockquote>
<p>For <code>reference types</code>, the value of the constructor property <code>can be modified</code>, but for <code>primitive types</code> it is <code>read-only</code>.</p>
</blockquote>
<p>For <code>reference types</code>, it’s easy to understand why the constructor can be changed — for example, in prototype chain inheritance patterns, we often need to reassign the constructor property to correct it</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Bar</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set Bar&#x27;s prototype to be an instance of Foo</span></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">foo</span> = <span class="string">&#x27;Hello JS&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> <span class="title class_">Bar</span>(); <span class="comment">// Create a new instance of Bar</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test);</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example1.5mnxgnu1xh.webp" alt="example1"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fix Bar.prototype.constructor so that it points back to Bar itself</span></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Bar</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> <span class="title class_">Bar</span>(); <span class="comment">// Create a new instance of Bar</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test);</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example2.8z6nb1am9z.webp" alt="example2"></p>
<p><strong>For primitive types, however, the constructor property is read-only. This applies to values such as 1, &quot;1&quot;, true, and Symbol. (null and undefined do not have a constructor property at all.)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Type</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> types = [<span class="number">1</span>, <span class="string">&quot;1&quot;</span>, <span class="literal">true</span>, <span class="title class_">Symbol</span>(<span class="number">1</span>)];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = types.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">  types[i].<span class="property">constructor</span> = <span class="title class_">Type</span>;</span><br><span class="line">  types[i] = [types[i].<span class="property">constructor</span>, types[i] <span class="keyword">instanceof</span> <span class="title class_">Type</span>, types[i].<span class="title function_">toString</span>()];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(types.<span class="title function_">join</span>(<span class="string">&quot;\n&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example3.3k84u03o9m.webp" alt="example3"></p>
<p><strong>Why is this the case?</strong></p>
<ul>
<li>Because <code>primitive values</code> are created by <code>native constructors</code> (built-in, read-only constructors). </li>
<li>This also demonstrates that <strong>relying on an object’s constructor property is not always safe</strong>.</li>
</ul>
<h2 id="Simulating-new"><a href="#Simulating-new" class="headerlink" title="Simulating new"></a>Simulating <code>new</code></h2><blockquote>
<p>The <code>new</code> operator creates an <code>instance</code> of a user-defined object type or of one of the built-in object types that has a <code>constructor</code>. (from <code>MDN</code>)</p>
</blockquote>
<p>When the code <code>new Foo(...)</code> is executed, the following steps occur:</p>
<ul>
<li>A new object is created that inherits from <code>Foo.prototype</code>.</li>
<li>The <code>constructor function Foo</code> is called with the specified arguments, and <strong>this is bound to the newly created object</strong>. (<code>new Foo</code> is equivalent to <code>new Foo()</code>, i.e., if no arguments are passed, <code>Foo</code> is called without parameters.)</li>
<li>The object returned by the constructor becomes the result of the new expression.</li>
<li>If the <code>constructor</code> doesn’t explicitly return an <code>object</code>, then the <code>object</code> created in <code>step 1</code> is used instead.</li>
</ul>
<p><strong>First Version</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createNew</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Create an empty object</span></span><br><span class="line">  <span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>(); </span><br><span class="line">  <span class="comment">// Get the constructor function (remove the first argument from arguments)</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Con</span> = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// Link to prototype</span></span><br><span class="line">  <span class="comment">// Equivalent: const obj = Object.create(constructor.prototype);</span></span><br><span class="line">  obj.<span class="property">__proto__</span> = <span class="title class_">Con</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="comment">// Bind this to the new object by applying the constructor</span></span><br><span class="line">  <span class="title class_">Con</span>.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// Return the new object</span></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Test</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Car</span>(<span class="params">color</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Car</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">start</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">color</span> + <span class="string">&quot; car start&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car = <span class="title function_">createNew</span>(<span class="title class_">Car</span>, <span class="string">&quot;black&quot;</span>);</span><br><span class="line">car.<span class="property">color</span>;  <span class="comment">// black</span></span><br><span class="line">car.<span class="title function_">start</span>(); <span class="comment">// black car start</span></span><br></pre></td></tr></table></figure>

<p>The above code already implements about 80% of new. Now let’s refine it.</p>
<p><strong>Special Return Cases of Constructors</strong></p>
<p>The constructor can return values in three ways:</p>
<ul>
<li><p><code>Returns an object</code> → the <code>this</code> binding is ignored, and only the <code>returned object</code> is used:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">age, name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">name</span>: name &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">18</span>, <span class="string">&quot;tn&quot;</span>);</span><br><span class="line">person.<span class="property">age</span>; <span class="comment">// undefined</span></span><br><span class="line">person.<span class="property">name</span>; <span class="comment">// &quot;tn&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>Returns nothing (i.e., return undefined)</code> → the created object is used as the result:</p>
<p>The instance <code>person</code> can only access the properties in the constructor, which is completely opposite to the above</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">age, name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">18</span>, <span class="string">&quot;tn&quot;</span>);</span><br><span class="line">person.<span class="property">age</span>; <span class="comment">// 18</span></span><br><span class="line">person.<span class="property">name</span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Returns a primitive value (other than undefined)</code> → the created object is still used:</p>
<p>Only properties in the constructor can be accessed in the <code>person</code> instance. Contrary to case 1, this results in no return value.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">age, name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;new person&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">18</span>, <span class="string">&quot;tn&quot;</span>);</span><br><span class="line">person.<span class="property">age</span>; <span class="comment">// 18</span></span><br><span class="line">person.<span class="property">name</span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>So we need to check <strong>whether the constructor explicitly returned an object</strong>.</p>
<ul>
<li>If so, return that object</li>
<li>Otherwise, return the newly created object.</li>
</ul>
<p><strong>Second Version</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Improved version</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createNew</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Create an empty object</span></span><br><span class="line">  <span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  <span class="comment">// Get the constructor function</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Con</span> = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// Link to prototype</span></span><br><span class="line">  obj.<span class="property">__proto__</span> = <span class="title class_">Con</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="comment">// Apply constructor to bind this</span></span><br><span class="line">  <span class="keyword">const</span> ret = <span class="title class_">Con</span>.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// Return the constructor’s return value if it’s an object, otherwise obj</span></span><br><span class="line">  <span class="keyword">return</span> ret <span class="keyword">instanceof</span> <span class="title class_">Object</span> ? ret : obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>Optimized Version (without using <strong>proto</strong>)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. Get constructor and remove it from arguments</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Con</span> = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// 2. Create a new object linked to the constructor’s prototype</span></span><br><span class="line">  <span class="keyword">var</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Con</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  <span class="comment">// 3. Apply constructor to bind this</span></span><br><span class="line">  <span class="keyword">var</span> ret = <span class="title class_">Con</span>.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// 4. Return constructor’s return object if it exists, otherwise obj</span></span><br><span class="line">  <span class="keyword">return</span> ret <span class="keyword">instanceof</span> <span class="title class_">Object</span> ? ret : obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>This fully simulates how the new operator works internally in JavaScript.</p>
<h2 id="Extension-How-to-Ensure-a-Constructor-Can-Only-Be-Called-with-new-and-Not-as-a-Regular-Function"><a href="#Extension-How-to-Ensure-a-Constructor-Can-Only-Be-Called-with-new-and-Not-as-a-Regular-Function" class="headerlink" title="Extension: How to Ensure a Constructor Can Only Be Called with new and Not as a Regular Function?"></a>Extension: How to Ensure a Constructor Can Only Be Called with new and Not as a Regular Function?</h2><p>In JavaScript, functions generally have two usage patterns:</p>
<ul>
<li>As a <code>constructor</code>: <code>new Func()</code></li>
<li>As a <code>regular function</code>: <code>Func()</code></li>
</ul>
<p>But internally, JavaScript doesn’t distinguish between the two. - By convention, we capitalize the first letter of constructor function names. </p>
<ul>
<li>However, calling a constructor function without <code>new</code> won’t throw an error automatically.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">firstName</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called with new</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;tn&quot;</span>));  <span class="comment">// Person &#123; firstName: &#x27;tn&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Called as a regular function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>(<span class="string">&quot;tn&quot;</span>));  <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p>The main difference between calling a function with <code>new</code> versus <code>calling it regularly</code> is what this points to:</p>
<ul>
<li>With <code>new</code>, this points to the <code>newly created instance</code>.</li>
<li>With a <code>regular call</code>, this points to <code>window in non-strict mode</code>, or <code>undefined in strict mode</code>.</li>
</ul>
<p>Therefore, to restrict the constructor to be called only by <code>new</code>, you can use the following solutions:</p>
<p><strong>Method 1: Using <code>instanceof</code> (older browsers)</strong></p>
<p><code>instanceof</code> checks <strong>whether the prototype property of a constructor appears in an object’s prototype chain</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object <span class="keyword">instanceof</span> constructor</span><br></pre></td></tr></table></figure>

<ul>
<li>If called with <code>new</code>, <code>this</code> will be the <code>instance</code>, so <code>this instanceof Constructor</code> will be <code>true</code>.</li>
<li>If called as a <code>regular function</code>, the check fails and throws an error:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">firstName</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Person</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;This constructor must be called with new&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>(<span class="string">&quot;tn&quot;</span>)); </span><br><span class="line"><span class="comment">// Uncaught TypeError: This constructor must be called with new</span></span><br></pre></td></tr></table></figure>

<p><code>Limitation</code>: This can be bypassed using <code>call or apply</code> to fake this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(), <span class="string">&quot;tn&quot;</span>)); <span class="comment">// Works, no error</span></span><br></pre></td></tr></table></figure>

<p><strong>Method 2: Using <code>new.target</code> (ES6)</strong></p>
<blockquote>
<p>&quot;ECMAScript 6 Primer&quot; mentions: </p>
<ul>
<li><code>ES6</code> introduces a <code>new.target</code> property for the <code>new</code> command. </li>
<li>This property is typically used within constructors and returns the constructor that the <code>new</code> command applies to. </li>
<li>If the constructor is not called via the <code>new</code> command or <code>Reflect.construct()</code>, <code>new.target</code> returns <code>undefined</code>. </li>
<li>Therefore, this property can be used to determine how the constructor was called.&quot;</li>
</ul>
</blockquote>
<p><code>new.target</code> is designed to determine how a constructor was called. Its usage is as follows:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span>.<span class="property">target</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called with new</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;new:&quot;</span>, <span class="keyword">new</span> <span class="title class_">Person</span>()); <span class="comment">// new: [Function: Person]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Called without new</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;not new:&quot;</span>, <span class="title class_">Person</span>()); <span class="comment">// not new: undefined</span></span><br></pre></td></tr></table></figure>

<p>You can use <code>new.target</code> to enforce new:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">new</span>.<span class="property">target</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;This constructor must be called with new&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>()); </span><br><span class="line"><span class="comment">// Uncaught TypeError: This constructor must be called with new</span></span><br></pre></td></tr></table></figure>

<p><strong>Method 3: Using <code>ES6 class</code> (Object-oriented programming. Best Practice)</strong></p>
<blockquote>
<p><code>Classes</code> in <code>ES6</code> must be instantiated with <code>new</code>.</p>
</blockquote>
<p><code>ES6</code> provides <code>Class</code> as <code>syntactic sugar</code> for <code>constructors</code>, enabling more semantically sound <code>object-oriented programming</code>.</p>
<ul>
<li><code>Class</code> also stipulates that <code>class</code> constructors must be called using <code>new</code>. </li>
<li>Therefore, using ES6 <code>Class</code> is strongly recommended for future <code>object-oriented</code> programming.</li>
</ul>
<p><code>Class</code> fixes many object-oriented programming flaws in <code>ES5</code>, such as the fact that all methods in a class are <code>not enumerable</code> and that all methods in a class cannot be used as constructors.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>()); </span><br><span class="line"><span class="comment">// Uncaught TypeError: Class constructor Person cannot be invoked without &#x27;new&#x27;</span></span><br></pre></td></tr></table></figure>

<p>✅ Advantages:</p>
<ul>
<li><code>class</code> enforces <code>new</code> automatically.</li>
<li><code>Class</code> methods are <code>non-enumerable</code> by default.</li>
<li><code>Class</code> methods cannot be used as <code>constructors</code>.</li>
</ul>
<p>In modern JavaScript, using <code>class</code> is the recommended approach to enforce proper constructor calls.</p>
<h2 id="Extension-Since-Class-Must-Be-Called-with-new-What-Is-the-Purpose-of-new-target"><a href="#Extension-Since-Class-Must-Be-Called-with-new-What-Is-the-Purpose-of-new-target" class="headerlink" title="Extension: Since Class Must Be Called with new, What Is the Purpose of new.target?"></a>Extension: Since Class Must Be Called with new, What Is the Purpose of new.target?</h2><p>Answer: <strong>It enables the implementation of <code>abstract classes</code>.</strong></p>
<p>Inside a Class, calling <code>new.target</code> returns the current class.</p>
<p>As <code>ECMAScript 6 Primer</code> points out: <strong>when a subclass inherits from a parent class, new.target will return the subclass</strong>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">type, name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span>.<span class="property">target</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `extends` is the keyword for implementing inheritance in classes</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(<span class="string">&quot;dog&quot;</span>, <span class="string">&quot;bao&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example4.2a57nolp15.webp" alt="example4"></p>
<p>From the example above, you can see that the return value differs depending on whether the parent class or the subclass is called.</p>
<p>This characteristic allows us to <strong>create a parent class that cannot be directly instantiated, but can still be extended and instantiated by subclasses — in other words, an <code>abstract class</code>.</strong></p>
<p><strong>What Is an <code>Abstract Class</code>?</strong></p>
<p>Take the example above: we define an <code>Animal</code> class to represent animals.</p>
<p><code>“Animal”</code> is an abstract concept; simply creating an Animal instance doesn’t specify what kind of animal it is.</p>
<p>Only when we instantiate concrete animals — like cats or dogs — does it make sense.</p>
<p>Therefore, Animal should not be directly instantiated. Instead, it should serve as a <code>base abstract class</code> that <strong>provides shared structure&#x2F;behavior for subclasses such as Dog or Cat</strong>.</p>
<p><strong>Using <code>new.target</code> to Implement Abstract Classes</strong></p>
<p>Since <code>new.target</code> returns different values depending on whether the parent or child class is invoked, we can leverage this to prevent direct instantiation of a parent (abstract) class:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">type, name, age</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="title class_">Animal</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Abstract class cannot be instantiated directly&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(<span class="string">&quot;dog&quot;</span>, <span class="string">&quot;bao&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;dog&quot;</span>, <span class="string">&quot;bao&quot;</span>, <span class="number">18</span>); </span><br><span class="line"><span class="comment">// Uncaught TypeError: Abstract class cannot be instantiated directly</span></span><br></pre></td></tr></table></figure>


<p>In summary:</p>
<ul>
<li>Even though Class must already be called with new, <code>new.target</code> provides a mechanism to distinguish between direct instantiation and subclass instantiation, making it especially useful for creating abstract classes in object-oriented JavaScript.</li>
</ul>
<h1 id="Function-Objects-and-Ordinary-Objects"><a href="#Function-Objects-and-Ordinary-Objects" class="headerlink" title="Function Objects and Ordinary Objects"></a>Function Objects and Ordinary Objects</h1><p>We often hear the phrase: <code>“Everything is an object.”</code></p>
<blockquote>
<p>An <code>object</code> is essentially <code>a collection of properties</code> (everything inside an object is a property; even methods are just properties since they are represented as key–value pairs).</p>
</blockquote>
<p>In JavaScript, there are several ways to create objects, such as <code>object literals</code>, using <code>constructors with new</code>, or via <code>Object.create()</code>.</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example3.7p3q4sjk0k.webp" alt="example3"></p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example4.2obnd8cpi0.webp" alt="example4"></p>
<p>For now, let’s ignore the specific meaning of the code examples above. What’s important is that they all produce objects, but with some key differences.</p>
<p><strong>In JavaScript, objects can be divided into <code>“function objects”</code> and <code>“ordinary objects”</code></strong></p>
<ul>
<li><code>Function objects</code> are objects implemented in JavaScript through functions to simulate classes — <strong><code>Object</code> and <code>Function</code> are classic examples of function objects</strong>.</li>
<li><code>Ordinary objects</code> are all other objects that are <code>not created as instances of Function</code>.</li>
</ul>
<p>In the code below, <code>obj1</code>, <code>obj2</code>, <code>obj3</code>, and <code>obj4</code> are ordinary objects, while <code>fun1</code>, <code>fun2</code>, and <code>fun3</code> are instances of <code>Function</code>, meaning they are <code>function objects</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun1</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> fun2 = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> fun3 = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;console.log(name)&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">const</span> obj3 = <span class="keyword">new</span> <span class="title function_">fun1</span>();</span><br><span class="line"><span class="keyword">const</span> obj4 = <span class="keyword">new</span> <span class="keyword">new</span> <span class="title class_">Function</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Object</span>); <span class="comment">// function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Function</span>); <span class="comment">// function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> fun1); <span class="comment">// function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> fun2); <span class="comment">// function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> fun3); <span class="comment">// function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> obj1); <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> obj2); <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> obj3); <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> obj4); <span class="comment">// object</span></span><br></pre></td></tr></table></figure>

<p>Thus, <strong><code>all instances of Function are function objects</code>, and everything else is considered an <code>ordinary object</code></strong> — including instances created from function objects.</p>
<blockquote>
<p>In JavaScript, everything is an object, and every object is created by some form of constructor.</p>
<p><strong>My understanding is that all objects are created by calling a function with the new operator</strong>.</p>
<p><code>Literal syntax is just syntactic sugar</code> (it’s essentially shorthand for new, providing the same functionality but with simpler usage). For example, both <code>function Foo()</code> and <code>let a = &#123; b: 1 &#125;</code> use constructors under the hood.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="comment">// A function is syntactic sugar</span></span><br><span class="line"><span class="comment">// Internally equivalent to: new Function()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">b</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="comment">// The literal internally is equivalent to: new Object()</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>When creating objects, <strong>it’s generally recommended to use literals</strong>.</p>
<ul>
<li>This is because using <code>new Object()</code> requires walking through the <code>scope chain</code> to <code>locate Object</code>, while literal notation avoids this overhead.</li>
</ul>
</blockquote>
<p><strong><code>Number</code>, <code>String</code>, <code>Boolean</code>, <code>Array</code>, <code>Object</code>, <code>Function</code>, <code>Date</code>, <code>RegExp</code>, <code>Error</code>, etc. are all <code>functions</code> — they are built-in native constructors that automatically exist in the runtime environment.</strong></p>
<p><code>Constructors</code> exist to <code>create objects</code> of specific types. </p>
<ul>
<li><strong><code>Objects</code> created from the same constructor share the same prototype and therefore share methods</strong>.</li>
<li>For example, all arrays can call the <code>push</code> method because they share the same prototype.</li>
</ul>
<blockquote>
<p><strong>The concepts of <code>prototype</code> and <code>prototype chain</code> both originate from objects and exist to serve objects.</strong></p>
</blockquote>
<h1 id="Prototype-prototype"><a href="#Prototype-prototype" class="headerlink" title="Prototype (prototype)"></a>Prototype (prototype)</h1><h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><p><code>JavaScript</code> is often described as a <code>prototype-based language</code>, which is different from class-based languages such as Java.</p>
<blockquote>
<p>The <code>prototype</code> is the foundation of JavaScript’s <code>object-oriented</code> system.</p>
</blockquote>
<blockquote>
<p>A <code>class</code> is an abstraction of the structure and behavior of a category of entities. </p>
<ul>
<li>In class-based OOP languages, the focus is on <code>abstraction</code> first — <strong>you must first design a generic class before you can instantiate objects from it, and only then deal with concrete instances</strong>.</li>
</ul>
</blockquote>
<blockquote>
<p>In a <code>prototype-based language</code> like <code>JavaScript</code>, <strong>the focus starts from the concrete — the behaviors of individual instances</strong>. </p>
<ul>
<li>Based on the characteristics of these instances, similar ones are linked to a <code>prototype object</code>.<br>The <code>prototype object</code> encapsulates shared behaviors and properties.<br>Instances linked to this prototype can &quot;copy&quot; its capabilities.</li>
</ul>
</blockquote>
<p><strong>In the prototype paradigm, new objects are created through this notion of copying</strong>. </p>
<ul>
<li>But this “copy” doesn’t mean literally duplicating the prototype in memory </li>
<li>It means <code>copying capabilities</code>, <code>not entities</code>. </li>
<li>In JavaScript, this is done by keeping a reference from the new object to its prototype, which effectively achieves the idea of “copying.”</li>
</ul>
<p><strong>Every object has a prototype object</strong>. </p>
<ul>
<li>Objects use their prototype as a template and inherit methods and properties from it. </li>
<li>These shared properties and methods are defined on the <code>constructor function’s prototype property</code>, rather than on the object instance itself.</li>
</ul>
<blockquote>
<p><strong>prototype &#x3D; an object that provides shared properties for other objects instances.</strong></p>
</blockquote>
<p>Therefore, <code>prototype itself is just an object</code> — it simply serves a special role.</p>
<blockquote>
<p><strong>Only functions have this property</strong>. </p>
<ul>
<li>It is an <code>explicit prototype property of function objects</code>.</li>
<li><code>When a function is declared, the prototype property is automatically created</code>. </li>
<li>It defines the common ancestor for the object instances created by that constructor function. </li>
<li>Objects created with that constructor inherit the properties and methods on its prototype.</li>
</ul>
</blockquote>
<p><strong>Almost all functions have this property, but there are exceptions</strong>. For example, if you create a function using the method below, you’ll find that it doesn’t have a prototype property:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">bind</span>();</span><br></pre></td></tr></table></figure>

<p>That’s because <code>Function.prototype</code> itself is a <code>function object</code> created by the JavaScript engine, and the engine does not add a prototype property to this object. The same applies to <code>Function.prototype.bind</code>.</p>
<p>By adding properties and methods to prototype</p>
<ul>
<li>Every object created from the constructor can inherit them. </li>
<li>Although each object is independent, they all share the same ancestor. </li>
<li>When accessing a property of an object, if the object doesn’t have it, the lookup continues up the chain to its prototype, and the property is accessed from there.</li>
</ul>
<h2 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h2><p><strong>The <code>prototype</code> object has a default property called <code>constructor</code>, which points back to the function that created that object.</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Person</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>The <code>constructor</code> is a <code>public</code> but <code>non-enumerable</code> property. </p>
<ul>
<li>Once the function’s prototype is reassigned, the new object will no longer have this property directly</li>
<li>Though it can still be accessed through the prototype chain</li>
</ul>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example5.7egwcylm9j.webp" alt="example5"></p>
<p>Important: <strong>Every object has a corresponding constructor, either its own or inherited</strong>.</p>
<ul>
<li>Strictly speaking, <code>only prototype objects themselves directly have the constructor property</code>.</li>
<li>Every time a function is created, JavaScript automatically creates a corresponding <code>prototype object</code> for that function.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span> created by a <span class="keyword">function</span>.<span class="property">__proto__</span> === <span class="title class_">That</span> <span class="keyword">function</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">The</span> <span class="keyword">function</span> itself</span><br></pre></td></tr></table></figure>

<p>Therefore, even if an object created by a function does not have its own constructor property, it can still find the correct constructor via its <code>__proto__</code>. This is why any object can ultimately trace back to its corresponding constructor.</p>
<blockquote>
<p>In fact, the constructor property is somewhat of a historical artifact, and it serves two main purposes:</p>
<ul>
<li>It allows an instance object to know which function constructed it.</li>
<li>It provides a way to extend a constructor in libraries by adding custom methods via <code>xx.constructor.method</code>.</li>
</ul>
</blockquote>
<h2 id="proto"><a href="#proto" class="headerlink" title="proto"></a><strong>proto</strong></h2><blockquote>
<ul>
<li>First, it’s important to clarify: <code>__proto__</code> and <code>constructor</code> belong to objects, while <code>prototype</code> belongs to <code>functions</code>.</li>
<li>However, in JavaScript, functions are also objects, so functions also have <code>__proto__</code> and <code>constructor</code>.</li>
</ul>
</blockquote>
<p><strong>Every object has this implicit prototype property (<code>__proto__</code>), which points to its prototype. (If the object was created by a constructor, it points to the constructor’s prototype.)</strong></p>
<ul>
<li>In other words, <code>__proto__</code> is present on all object instances and gives access to their prototype. </li>
<li>Meanwhile, <code>prototype</code> is a property of <code>constructor functions</code>. </li>
<li>Although the two are not the same, <code>obj.__proto__</code> and <code>Constructor.prototype</code> usually point to the <code>same object</code>.</li>
</ul>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example6.1sf5z3kbg2.webp" alt="example6"></p>
<p><code>__proto__</code> essentially exposes the internal <code>[[Prototype]] slot</code> (which is either an <code>object</code> or <code>null</code>). </p>
<ul>
<li>Since <code>[[Prototype]]</code> is an internal slot and cannot be accessed directly, many browsers historically implemented <code>__proto__</code> to make it accessible.</li>
</ul>
<p>Thus, <code>ECMAScript</code> later standardized <code>__proto__</code> (for compatibility with browsers), but it is not recommended for use:</p>
<ul>
<li>You can access a <code>prototype</code> using <code>obj.__proto__</code>, or set it with <code>obj.__proto__ = anotherObj</code>.</li>
<li>However, for performance and clarity, it’s better to use <code>Object.getPrototypeOf(obj)</code> and <code>Object.setPrototypeOf(obj, anotherObj)</code>.</li>
</ul>
<p>In <code>ES6</code>, <code>__proto__</code> became part of the spec to ensure <code>consistency</code> across browsers, but it should be avoided in favor of the standard methods.</p>
<p><strong>Note:</strong></p>
<ul>
<li><code>__proto__</code> cannot be discovered via <code>for...in</code> or <code>Object.keys(obj)</code>.</li>
<li><code>__proto__</code> is actually defined as an accessor property (using a getter and setter) on <code>Object.prototype</code>. Accessing <code>obj.__proto__</code> uses the <code>getter/setter </code>under the hood.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;__proto__&#x27;</span>, &#123; </span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get&#x27;</span>);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;); </span><br><span class="line">(&#123;&#125;).<span class="property">__proto__</span>; </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="keyword">new</span> <span class="title class_">Object</span>()).<span class="property">__proto__</span>); </span><br><span class="line"><span class="comment">// get </span></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">__proto__</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[<span class="string">&#x27;[[prototype]]&#x27;</span>] === <span class="literal">null</span> ? weakMap.<span class="title function_">get</span>(<span class="variable language_">this</span>) : <span class="variable language_">this</span>[<span class="string">&#x27;[[prototype]]&#x27;</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">__proto__</span>(<span class="params">newPrototype</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(newPrototype)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">`<span class="subst">$&#123;newPrototype&#125;</span> is not extensible`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> newPrototype === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> newPrototype === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (newPrototype === <span class="literal">null</span> || isObject) &#123;</span><br><span class="line">      <span class="comment">// 若之前通过 __proto__ 设置成 null</span></span><br><span class="line">      <span class="comment">// 此时再通过给 __proto__ 赋值的方式修改原型都是徒劳</span></span><br><span class="line">      <span class="comment">// 表现就是 obj.__proto__ = &#123; a: 1 &#125; 就像一个普通属性 obj.xxx = &#123; a: 1 &#125;</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>[<span class="string">&#x27;[[prototype]]&#x27;</span>] === <span class="literal">null</span>) &#123;</span><br><span class="line">        weakMap.<span class="title function_">set</span>(<span class="variable language_">this</span>, newPrototype);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>[<span class="string">&#x27;[[prototype]]&#x27;</span>] = newPrototype;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ... 其它属性如 toString，hasOwnProperty 等</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>Behavior with <code>null</code></strong></p>
<p>If you explicitly assign <code>obj.__proto__ = null</code>, the object’s prototype is indeed set to <code>null</code>. But afterward, further attempts to set <code>__proto__</code> won’t actually change the prototype; it will behave like setting a regular property instead.</p>
<p>To truly change the prototype again, you must use <code>Reflect.setPrototypeOf()</code> or <code>Object.setPrototypeOf()</code>.</p>
<blockquote>
<p><code>Reflect.setPrototypeOf()</code> can modify the prototype because it directly modifies the prototype property of the object, that is, it directly assigns the <code>[[prototype]]</code> property of the object internally without going through the <code>getter</code> of <code>__proto__</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;xiaoming&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">__proto__</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getPrototypeOf</span>(obj)); <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Assigning again</span></span><br><span class="line">obj.<span class="property">__proto__</span> = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>); <span class="comment">// &#123; a: 1 &#125; -- but just as a regular property</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getPrototypeOf</span>(obj)); <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">setPrototypeOf</span>(obj, &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getPrototypeOf</span>(obj)); <span class="comment">// &#123; b: 2 &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Performance Concerns</strong></p>
<p>Changing the <code>[[Prototype]]</code> of an object (via <code>__proto__</code>, <code>Object.setPrototypeOf</code>, or <code>Reflect.setPrototypeOf</code>) has a serious negative impact on performance. </p>
<ul>
<li>The slowdown isn’t just in the reassignment itself</li>
<li>It affects all objects that inherit from that prototype, since the engine must re-optimize lookup chains.</li>
</ul>
<p>To read or modify the <code>[[Prototype]]</code> property of an object, the following solution is recommended. However, setting the <code>[[Prototype]]</code> of an object is still a slow operation. Again, <strong>if performance is a concern, avoid this operation</strong>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get prototype</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj);</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getPrototypeOf</span>(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set prototype</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(obj, anotherObj);</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">setPrototypeOf</span>(obj, anotherObj);</span><br></pre></td></tr></table></figure>

<p><strong>Summary</strong></p>
<ul>
<li><code>__proto__</code> exists on all objects and points to their <code>prototype</code>.</li>
<li>Its role: when accessing a property on an object, if it doesn’t exist on the object itself, JavaScript looks up the chain through <code>__proto__</code> until it reaches <code>null</code>(return <code>undefined</code>).</li>
<li>This lookup process forms what we call the <code>prototype chain</code>.</li>
</ul>
<p>Since JavaScript does not have classical classes, inheritance is simulated through the <code>prototype chain</code>. By linking objects through <code>__proto__</code>, JS enables one object to access properties and methods defined on another.</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example7.m7470yjq.webp" alt="example7"></p>
<h2 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create()"></a>Object.create()</h2><p>Previously, we mentioned that objects in JavaScript are mainly created in two ways:</p>
<ul>
<li>Using the <code>new</code> operator followed by a function call.</li>
<li>Using <code>object literal</code> syntax.</li>
</ul>
<p>The third way is via <code>Object.create()</code>, introduced in <code>ES5</code>.</p>
<ul>
<li>This method creates a <code>new object</code>.</li>
<li>The first parameter is an object that will be used as the <code>prototype</code> of the new object.</li>
<li>The second parameter is an optional property descriptor (rarely used; defaults to <code>undefined</code>).</li>
</ul>
<blockquote>
<p>What we usually call an <code>“empty object”</code> isn’t truly empty. </p>
<ul>
<li>Its prototype points to <code>Object.prototype</code>, so it still inherits methods like <code>hasOwnProperty</code>, <code>toString</code>, and <code>valueOf</code>.</li>
</ul>
</blockquote>
<ul>
<li>To create a new object that inherits from another object’s <code>[[Prototype]]</code>, it’s recommended to use <code>Object.create()</code>.</li>
<li>To create an object that does not inherit any properties, use <code>Object.create(null)</code>.</li>
<li>To create a regular object similar to one made with literals, use O<code>bject.create(Object.prototype)</code>.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="comment">// Equivalent to</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">obj.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">obj.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="Simulating-Object-create"><a href="#Simulating-Object-create" class="headerlink" title="Simulating Object.create"></a>Simulating Object.create</h3><p><strong>Simple version:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createObj</span>(<span class="params">proto</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> F = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = proto;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Complete version:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define a function that accepts:</span></span><br><span class="line"><span class="comment">// proto: The object to use as the prototype of the new object</span></span><br><span class="line"><span class="comment">// propertyObject: An optional property descriptor object (for use with</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createObj</span>(<span class="params">proto, propertyObject = <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">  <span class="comment">// First, perform a type check to ensure that proto is an object or function (or null); otherwise, throw an error. </span></span><br><span class="line">  <span class="comment">// This matches native behavior.</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> proto !== <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> proto !== <span class="string">&#x27;function&#x27;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Object prototype may only be an Object or null.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // This isn&#x27;t entirely correct: you&#x27;re only creating a TypeError instance but not throwing it, so this code is invalid (it should be throw new TypeError(...)). </span></span><br><span class="line">  <span class="comment">// However, the code below also checks for undefined, so it doesn&#x27;t affect the functionality; it&#x27;s just not very precise.</span></span><br><span class="line">  <span class="keyword">if</span>(propertyObject == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Cannot convert undefined or null to object&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This section is key: Using a temporary constructor F, we achieve the effect of `obj.__proto__ = proto`.</span></span><br><span class="line">  <span class="comment">// Equivalent to `const obj = Object.create(proto);`</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = proto;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// If `propertyObject` exists, use `Object.defineProperties` to add properties to the new object.</span></span><br><span class="line">  <span class="keyword">if</span>(propertyObject != <span class="literal">undefined</span>) <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(obj, propertyObject);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Create an object without a prototype object, `Object.create(null)`</span></span><br><span class="line">  <span class="comment">// This step supports `Object.create(null),` which creates a pure object without a prototype chain. This is often used with dictionary objects (objects generated by `Object.create(null)` lack default inherited properties like `toString` and `hasOwnProperty`).</span></span><br><span class="line">  <span class="comment">// Handling `__proto__ = null` only works in some JS engines. In more modern environments, Object.setPrototypeOf(obj, null) can be used for safer setup.</span></span><br><span class="line">  <span class="keyword">if</span>(proto === <span class="literal">null</span>) obj.<span class="property">__proto__</span> = <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Finally, return the created object.</span></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Prototype-Chain"><a href="#Prototype-Chain" class="headerlink" title="Prototype Chain"></a>Prototype Chain</h1><h2 id="Concept-1"><a href="#Concept-1" class="headerlink" title="Concept"></a>Concept</h2><p>When accessing a property on an <code>object</code> obj:</p>
<ul>
<li>If the property does not exist directly on <code>obj</code>, the engine will look up its <code>prototype</code> via <code>__proto__</code>, i.e., <code>obj.__proto__</code>.</li>
<li>If the property is found on that prototype, it returns the value. If not, it continues to search on the <code>prototype’s prototype</code> — <code>obj.__proto__.__proto__</code>, and so on...</li>
<li>This lookup continues all the way up to the base object prototype, i.e., <code>Object.prototype</code>. If still not found, it proceeds to <code>Object.prototype.__proto__</code>, which is <code>null</code>, and finally returns <code>undefined</code>.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Object</span>().<span class="property">__proto__</span>.<span class="property">__proto__</span>); <span class="comment">// null</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="literal">null</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>This shows why it&#39;s called a <code>prototype chain</code> and not a <code>prototype loop</code> — <code>it has a definite end</code>. <strong>The top of the prototype chain is <code>null</code></strong>. Once reached, the lookup stops and returns <code>undefined</code>, avoiding infinite loops.</p>
<p><strong>Therefore, the <code>prototype chain</code> can be described as a chain of objects linked via the <code>__proto__</code> property, ending at <code>Object.prototype.__proto__</code>, which is <code>null</code>.</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, grade</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">grade</span> = grade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">gender</span>); <span class="comment">// =&gt; undefined</span></span><br></pre></td></tr></table></figure>

<p>The lookup process for <code>stu.gender</code> is illustrated below:</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example8.70agm3dbdh.webp" alt="example8"></p>
<p>And the <code>prototype chain</code> for the <code>Student</code> function is shown here:</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example9.102ahd3por.webp" alt="example9"></p>
<blockquote>
<p>Earlier we discussed the difference between <code>prototype</code> and <code>__proto__</code>:</p>
<ul>
<li><code>prototype</code> is a property of <code>constructor functions</code>.</li>
<li><code>__proto__</code> is a property that exists on every <code>instance object</code>.</li>
</ul>
</blockquote>
<p>While they often point to the same object, they are fundamentally different.</p>
<p><strong>So which of these actually constructs the <code>prototype chain</code>?</strong></p>
<ul>
<li>As shown above, <code>Student.prototype</code> (i.e., the prototype of the constructor) is not part of the chain itself but rather a reference point in the chain.</li>
<li><strong>The <code>prototype chain</code> is built via the <code>__proto__</code> property</strong>, such as:<ul>
<li><code>stu.__proto__</code> → points to <code>Student.prototype</code></li>
<li><code>stu.__proto__.__proto__</code> → points to <code>Object.prototype</code></li>
<li>and so on, until it reaches null</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>You can understand it this way: <code>Student</code> is a <code>constructor</code> (a function), and it has a <code>prototype reference</code>. </li>
<li>When you create a new object using <code>new Student()</code>, JavaScript automatically sets <code>stu.__proto__</code> to point to <code>Student.prototype</code>.</li>
</ul>
</blockquote>
<p><strong>Common Pitfall</strong></p>
<ul>
<li>Avoid assignments like <code>Bar.prototype = Foo</code>, because that sets the prototype of <code>Bar</code> to the function <code>Foo</code> itself, not to <code>Foo.prototype</code>.</li>
<li>This misleads the <code>prototype chain</code>. Instead of inheriting methods from <code>Foo.prototype</code>, it will incorrectly reference <code>Function.prototype</code>.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getMethod</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;method&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Foo</span>; <span class="comment">// Bar.prototype now incorrectly points to the function Foo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bar = <span class="keyword">new</span> <span class="title class_">Bar</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(bar);</span><br><span class="line">bar.<span class="title function_">getMethod</span>(); <span class="comment">// ❌ bar.getMethod is not a function</span></span><br><span class="line"></span><br><span class="line">bar.<span class="property">__proto__</span> === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><strong>Correct way to inherit:</strong></p>
<ul>
<li>If you want <code>Bar</code> instances to inherit from <code>Foo.prototype</code>, you should do:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Bar</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Property-Access-Modification-on-the-Prototype-Chain"><a href="#Property-Access-Modification-on-the-Prototype-Chain" class="headerlink" title="Property Access &amp; Modification on the Prototype Chain"></a>Property Access &amp; Modification on the Prototype Chain</h2><p>When modifying a <code>reference-type</code> property that exists on the <code>prototype</code> (but not on the instance itself), the change affects all instances that inherit from that <code>prototype</code> — because they share the same reference.</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example10.45t1wu18m.webp" alt="example10"></p>
<p><strong>Can we delete prototype properties through an instance?</strong></p>
<ul>
<li>Given that property access will walk up the prototype chain if it&#39;s not found on the object itself, one might wonder: <code>If I delete the property from the instance, will it also remove it from the prototype?</code></li>
<li>The answer is no.</li>
<li>Deleting a property from an instance does not remove it from the prototype. The property will still be accessible via the prototype chain.</li>
</ul>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example11.5fkpmmg3wh.webp" alt="example11"></p>
<p>So we can conclude: <strong>Instances cannot delete properties from their prototype.</strong></p>
<p><strong>Understanding this in Methods</strong></p>
<p>When a method is called, the value of <code>this</code> is determined by the object that invokes the method, not where the method is defined.</p>
<p>In short: <strong>(Who calls it, this points to who)</strong>.</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example12.8vn1eppqyl.webp" alt="example12"></p>
<h1 id="instanceof-Operator"><a href="#instanceof-Operator" class="headerlink" title="instanceof Operator"></a>instanceof Operator</h1><h2 id="Concept-2"><a href="#Concept-2" class="headerlink" title="Concept"></a>Concept</h2><p>Earlier we noted that developers often use the <code>typeof</code> operator to determine a variable’s type.</p>
<p>However, for <code>reference types</code>, <code>typeof</code> is not very informative — it returns <code>&quot;object&quot;</code> for almost everything except <code>functions</code> (which return &quot;function&quot;).</p>
<p>According to <code>MDN</code>, the <code>instanceof</code> operator: <strong>Tests whether the prototype property of a constructor appears anywhere in an object’s prototype chain</strong>.</p>
<p>In other words, <code>instanceof</code> works similarly to <code>typeof</code>, but <strong>specifically for checking if an object is an instance of a particular constructor</strong>. If <code>obj instanceof A is true, then obj is an instance of A</code>.</p>
<blockquote>
<p>In one sentence: <code>obj instanceof ConstructorA</code> is equivalent to checking whether <code>ConstructorA.prototype</code> exists somewhere on <code>obj’s prototype chain</code>.</p>
</blockquote>
<p><strong>How It Works</strong></p>
<ul>
<li>The <code>left-hand side</code> of <code>instanceof</code> is an <code>object</code>.</li>
<li>The <code>right-hand side</code> is a <code>constructor function</code>.</li>
<li>JavaScript walks up the object’s <code>prototype chain</code> (via <code>__proto__</code>) looking for the <code>constructor’s prototype</code>.</li>
<li>If found, it returns <code>true</code>.</li>
<li>If the <code>chain</code> ends at <code>null</code> (<code>Object.prototype.__proto__</code>), it returns <code>false</code>.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define constructors</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">C</span>(<span class="params"></span>) &#123;&#125; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">D</span>(<span class="params"></span>) &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o1 = <span class="keyword">new</span> <span class="title function_">C</span>();</span><br><span class="line">o1 <span class="keyword">instanceof</span> C; <span class="comment">// true — because Object.getPrototypeOf(o1) === C.prototype</span></span><br><span class="line"></span><br><span class="line">o1 <span class="keyword">instanceof</span> D; <span class="comment">// false — because D.prototype is not on o1&#x27;s prototype chain</span></span><br><span class="line"></span><br><span class="line">o1 <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true — because Object.prototype.isPrototypeOf(o1) returns true</span></span><br><span class="line">C.<span class="property"><span class="keyword">prototype</span></span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true — same reasoning</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Modify C.prototype</span></span><br><span class="line">C.<span class="property"><span class="keyword">prototype</span></span> = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> o2 = <span class="keyword">new</span> <span class="title function_">C</span>();</span><br><span class="line"></span><br><span class="line">o2 <span class="keyword">instanceof</span> C; <span class="comment">// true</span></span><br><span class="line">o1 <span class="keyword">instanceof</span> C; <span class="comment">// false — because C.prototype now points to a new empty object, </span></span><br><span class="line">                 <span class="comment">// which is no longer on o1’s prototype chain</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Inheritance example</span></span><br><span class="line">D.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">C</span>();</span><br><span class="line"><span class="keyword">const</span> o3 = <span class="keyword">new</span> <span class="title function_">D</span>();</span><br><span class="line">o3 <span class="keyword">instanceof</span> D; <span class="comment">// true</span></span><br><span class="line">o3 <span class="keyword">instanceof</span> C; <span class="comment">// true — because C.prototype is now on o3&#x27;s prototype chain</span></span><br></pre></td></tr></table></figure>

<p><strong>Key Difference from typeof</strong></p>
<ul>
<li>Unlike <code>typeof</code>, which gives you a broad category of a value, - <code>instanceof</code> explicitly checks <code>whether an object belongs to a specific constructor’s prototype chain</code>.</li>
</ul>
<h2 id="Simulating-instanceof"><a href="#Simulating-instanceof" class="headerlink" title="Simulating instanceof()"></a>Simulating instanceof()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Recursive version</span></span><br><span class="line"><span class="comment">// `obj` is the object to check (left-hand side)</span></span><br><span class="line"><span class="comment">// `Constructor` is the constructor function (right-hand side)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceOf</span>(<span class="params">obj, Constructor</span>) &#123;</span><br><span class="line">  <span class="comment">// get the prototype of the constructor</span></span><br><span class="line">  <span class="keyword">let</span> rightP = <span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="comment">// get the prototype chain of the object</span></span><br><span class="line">  <span class="keyword">let</span> leftP = obj.<span class="property">__proto__</span>;</span><br><span class="line">  <span class="comment">// reached the end of the chain → not found</span></span><br><span class="line">  <span class="keyword">if</span> (leftP === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// match found</span></span><br><span class="line">  <span class="keyword">if</span> (leftP === rightP) <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// recurse up the chain</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">myInstanceOf</span>(obj.<span class="property">__proto__</span>, <span class="title class_">Constructor</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Iterative version</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">left, right</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> prototype = right.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  left = left.<span class="property">__proto__</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// reached top of prototype chain</span></span><br><span class="line">    <span class="keyword">if</span> (left === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// match found</span></span><br><span class="line">    <span class="keyword">if</span> (prototype === left) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// go up one level</span></span><br><span class="line">    left = left.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, with this understanding, we can explain some seemingly confusing instanceof results:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line">fn <span class="keyword">instanceof</span> <span class="title class_">Function</span>; <span class="comment">// true</span></span><br><span class="line">fn <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 1. fn.__proto__ === Function.prototype;</span></span><br><span class="line"><span class="comment">// 2. fn.__proto__.__proto__ === Function.prototype.__proto__ === Object.prototype;</span></span><br><span class="line"></span><br><span class="line">arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>; <span class="comment">// true</span></span><br><span class="line">arr <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 1. arr.__proto__ === Array.prototype;</span></span><br><span class="line"><span class="comment">// 2. arr.__proto__.__proto__ === Array.prototype.__proto__ === Object.prototype;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 1. Object.__proto__ === Function.prototype;</span></span><br><span class="line"><span class="comment">// 2. Object.__proto__.__proto__ === Function.prototype.__proto__ === Object.prototype;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span> <span class="keyword">instanceof</span> <span class="title class_">Function</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Function</span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 1. Function.__proto__ === Function.prototype;</span></span><br><span class="line"><span class="comment">// 2. Function.__proto__.__proto__ === Object.prototype;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span> <span class="keyword">instanceof</span> <span class="title class_">Function</span>; <span class="comment">// true </span></span><br><span class="line"><span class="title class_">Foo</span> <span class="keyword">instanceof</span> <span class="title class_">Foo</span>; <span class="comment">// false</span></span><br><span class="line"><span class="comment">// 1. Foo.__proto__ === Function.prototype;</span></span><br><span class="line"><span class="comment">// 2. Foo.__proto__.__proto__ === Function.prototype.__proto__ = Object.prototype;</span></span><br><span class="line"><span class="comment">// 3. Foo.__proto__.__proto__.__proto__ === Object.prototype.__proto__ = null;</span></span><br><span class="line"><span class="comment">// 4. null</span></span><br></pre></td></tr></table></figure>

<p><strong>Summary:</strong></p>
<ul>
<li>The <code>instanceof</code> operator checks whether the prototype property of a constructor appears anywhere in the <code>prototype chain</code> of a given <code>object</code>.</li>
<li>In essence, it reflects a <code>prototype-based inheritance relationship</code> — not just <code>type identity</code>.</li>
</ul>
<h1 id="Object-Function"><a href="#Object-Function" class="headerlink" title="Object &amp; Function"></a>Object &amp; Function</h1><p>We previously encountered these statements:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>;      <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>;    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>But why are these true?</p>
<h2 id="Object-prototype"><a href="#Object-prototype" class="headerlink" title="Object.prototype"></a>Object.prototype</h2><blockquote>
<p>ECMAScript Specification:</p>
<ul>
<li>The value of the <code>[[Prototype]]</code> internal property of the <code>Object.prototype</code> object is <code>null</code>.</li>
<li>Its <code>[[Class]]</code> is <code>&quot;Object&quot;</code>, and its <code>[[Extensible]]</code> value is initially true.</li>
</ul>
</blockquote>
<p><code>Object.prototype</code> is the <code>prototype object</code> of <code>Object</code>.</p>
<ul>
<li>Its <code>[[Prototype]]</code> is <code>null</code>, making it the <code>top</code> of the prototype chain.</li>
<li>The accessor <code>__proto__</code> exposes an object’s internal <code>[[Prototype]]</code>.</li>
</ul>
<p><strong>Not created by <code>Object</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line">foo.<span class="property">__proto__</span> === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>In normal cases, <strong>an <code>instance’s __proto__</code> points to the <code>constructor’s prototype</code>.</strong></p>
<p>However, <code>Object.prototype.__proto__ === null</code>, so:</p>
<ul>
<li><code>Object.prototype</code> was not created by the <code>Object constructor</code>.</li>
<li>It is a built-in object created by the <code>JavaScript engine</code> according to <code>ECMAScript specification</code>.</li>
</ul>
<p><strong>Key Insight:</strong></p>
<ul>
<li><code>All instances are objects, but not all objects are instances (of a constructor)</code>.</li>
<li>Excluding <code>null</code>, <strong><code>Object.prototype</code> sits at the very top of the prototype chain</strong>. </li>
<li>All object instances inherit common methods like <code>toString</code> from it.</li>
</ul>
<h2 id="Function-prototype"><a href="#Function-prototype" class="headerlink" title="Function.prototype"></a>Function.prototype</h2><blockquote>
<p>ECMAScript Specification: </p>
<ul>
<li><p>The Function prototype object is itself a Function object (its [[Class]] is &quot;Function&quot;).</p>
</li>
<li><p>The value of the [[Prototype]] internal property of the Function prototype object is the standard built-in Object prototype object.</p>
</li>
<li><p>The Function prototype object does not have a <code>valueOf</code> property of its own; however, it inherits the <code>valueOf</code> property from the <code>Object prototype Object</code></p>
</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>;           <span class="comment">// ƒ () &#123; [native code] &#125;</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p><strong><code>Function.prototype</code> is a <code>function</code>, but with <code>special behavior</code>.</strong></p>
<p>Unlike normal functions, it doesn&#39;t have its own prototype property.</p>
<p>Similarly:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">bind</span>(); <span class="comment">// ƒ () &#123; [native code] &#125;</span></span><br><span class="line">fun.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p>This happens because <code>Function.prototype</code> is created internally by the <code>engine</code> and doesn’t need a <code>prototype</code>. If it had one, we’d end up with meaningless infinite chains like <code>Function.prototype.prototype.prototype</code>...</p>
<p><strong>Summary:</strong></p>
<ul>
<li><code>Function.prototype</code> is <code>non-writable</code>, <code>non-configurable</code>, and <code>non-enumerable</code>.</li>
<li>It is the prototype of all function objects.</li>
<li>All <code>functions’ __proto__ </code> point to it.</li>
</ul>
<blockquote>
<p>The engine creates <code>Object.prototype</code> first, then creates <code>Function.prototype</code> and links them together.</p>
</blockquote>
<h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p>In <code>JavaScript</code>, both <code>Object</code> and <code>Function</code> are <code>constructor functions</code>, used to <code>create object and function instances</code> respectively.</p>
<blockquote>
<p>ECMAScript:</p>
<ul>
<li><ul>
<li>The <code>[[Prototype]]</code> of the <code>Object constructor</code> is the standard built-in <code>Function.prototype</code>.</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><code>Object</code> is essentially <code>function Object() &#123;&#125;</code>.</p>
<ul>
<li>When you write <code>let foo = &#123;&#125;</code>, it&#39;s equivalent to <code>new Object()</code>.</li>
</ul>
<p>During construction:</p>
<ul>
<li>The <code>newly created object’s [[Prototype]]</code> is <code>Object.prototype</code></li>
</ul>
<p>You can also <code>create objects</code> through other <code>literals</code> or <code>constructors</code>:</p>
<ul>
<li><code>Object literal &#123;&#125;</code> -&gt; <code>Object.prototype</code></li>
<li><code>Array literal []</code> -&gt;	<code>Array.prototype</code></li>
<li>Function declaration <code>function f()&#123;&#125;</code>	-&gt; <code>Function.prototype</code></li>
<li><code>new Function()</code> -&gt;	<code>Function.prototype</code></li>
<li><code>new Foo()</code> (custom constructor)	-&gt; <code>Foo.prototype</code></li>
<li><code>new fun()</code>, where <code>fun</code> is one of the built-in constructor functions provided by <code>JS</code> (<code>Object</code>, <code>Function</code>, <code>Array</code>, <code>Boolean</code>, <code>Date</code>, <code>Number</code>, <code>String</code>, etc.) -&gt; <code>fun.prototype</code>.</li>
<li>Using other <code>JS</code> constructor functions have their <code>[[Prototype]]</code> value set to the <code>prototype</code> property of that constructor function.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;              <span class="comment">// o → Object.prototype → null</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="string">&quot;yo&quot;</span>, <span class="string">&quot;hi&quot;</span>];          <span class="comment">// a → Array.prototype → Object.prototype → null</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;     <span class="comment">// f → Function.prototype → Object.prototype → null</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="keyword">new</span> <span class="title class_">Function</span>();      <span class="comment">// fun → Function.prototype → Object.prototype → null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>();           <span class="comment">// foo → Foo.prototype → Object.prototype → null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line"><span class="keyword">let</span> foo2 = <span class="keyword">new</span> <span class="title class_">Foo</span>();          <span class="comment">// foo2 → Object.prototype → null</span></span><br></pre></td></tr></table></figure>

<h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><blockquote>
<p>ECMAScript:</p>
<ul>
<li>The Function constructor is itself a Function object and its [[Class]] is &quot;Function&quot;. </li>
<li>The value of the [[Prototype]] internal property of the Function constructor is the standard built-in Function prototype object</li>
</ul>
</blockquote>
<p>The <code>Function</code> constructor is a function object whose <code>[[Class]]</code> property is <code>Function</code>. The <code>[[Prototype]]</code> property of <code>Function</code> points to <code>Function.prototype</code>, that is:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><code>Function</code> is also <code>function Function() &#123;&#125;</code>.</p>
<ul>
<li><code>function foo() &#123;&#125;</code> is essentially equivalent to <code>new Function(...)</code>.</li>
<li>However, since <code>Function.prototype</code> is created by the engine, we conclude: <code>Not all functions are created via new Function()</code>.</li>
</ul>
<h2 id="The-Chicken-Egg-Paradox"><a href="#The-Chicken-Egg-Paradox" class="headerlink" title="The Chicken &amp; Egg Paradox"></a>The Chicken &amp; Egg Paradox</h2><p>Let’s look at these:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span> <span class="keyword">instanceof</span> <span class="title class_">Function</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span> <span class="keyword">instanceof</span> <span class="title class_">Function</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>The <code>Object</code> constructor inherits <code>Function.prototype</code>. </p>
<ul>
<li>All <code>Function objects</code> inherit directly from the <code>Function</code> object (the system&#39;s built-in constructor). </li>
<li><code>Function objects</code> include <code>Function</code>, <code>Object</code>, <code>Array</code>, <code>String</code>, <code>Number</code>, <code>RegExp</code>, <code>Date</code>, etc. </li>
<li>In fact, <code>Function</code> is not only used for <code>constructors</code>, it also acts as a <code>constructor</code> for <code>Function objects</code>.</li>
</ul>
<p>At the same time, the <code>Function</code> constructor inherits <code>Object.prototype</code>, which creates a <code>chicken and egg</code> problem. Because both <code>Function.prototype</code> and <code>Function.__proto__</code> point to <code>Function.prototype</code></p>
<p>This creates a circular relationship. So which came first?</p>
<p><strong>Is Function an instance of itself?</strong> There are two schools of thought:</p>
<ul>
<li><p><code>YES</code>: </p>
<ul>
<li>By definition, if <code>a instanceof b</code> is true, then b.prototype exists in a&#39;s prototype chain.</li>
<li><code>Function instanceof Function</code> returns true, which means: <code>Object.getPrototypeOf(Function) === Function.prototype</code>;</li>
</ul>
</li>
<li><p><code>NO (more widely accepted)</code>:</p>
<ul>
<li><code>Function</code> is a built-in object, not created by calling <code>new Function()</code>.</li>
<li>When we write <code>function f() &#123;&#125;</code> or <code>x =&gt; x</code>, no constructor is called explicitly.</li>
</ul>
</li>
</ul>
<p>I personally prefer the second explanation, that <code>Function.prototype</code> came first, and <code>function Function()</code> came later. Therefore, there&#39;s no chicken-and-egg problem. By pointing <code>Function.__proto__</code> to <code>Function.prototype</code>, my understanding is:</p>
<ul>
<li><strong>All other constructors can find <code>Function.prototype</code> through the prototype chain, and <code>Function</code> is essentially a function object. In fact, <code>Function</code> is just an ancestor, a constructor, not an instance of a function object. Therefore, the <code>__proto__</code> property is unnecessary. However, this would make <code>Function</code> look different, so we added the <code>__proto__</code> property and made it point to <code>Function.prototype</code>.</strong></li>
<li><strong>This simply serves to demonstrate that <code>Function</code>, as a native constructor, is itself a function object. This also ensures the integrity of the prototype chain, allowing <code>Function</code> to access methods defined on <code>Object.prototype</code>.</strong></li>
</ul>
<blockquote>
<ul>
<li>All function objects (including <code>Object</code> objects) directly inherit from <code>Function objects</code>. </li>
<li><code>Function objects</code> directly inherit from themselves, and ultimately inherit from <code>Object</code> objects. </li>
<li><code>Object</code> and <code>Function</code> objects inherit from each other.</li>
<li><code>Function.prototype</code> was introduced only after <code>Function()</code> was introduced, and all other constructors are generated from <code>Function()</code>.</li>
</ul>
</blockquote>
<p>All <code>objects</code> inherit from <code>Object.prototype</code>, while all <code>function objects</code> inherit from <code>Function.prototype</code> (Function.prototype ultimately inherits from Object.prototype). This explains the difference between <code>ordinary objects</code> and <code>function objects</code>:</p>
<ul>
<li><code>Ordinary objects</code> directly inherit from <code>Object.prototype</code>, while <code>function objects</code> also inherit from <code>Function.prototype</code>.</li>
</ul>
<h2 id="Key-Takeaways"><a href="#Key-Takeaways" class="headerlink" title="Key Takeaways"></a>Key Takeaways</h2><ul>
<li><code>Object</code> is the parent of all objects, and all objects can be found through <code>__proto__</code>.</li>
<li><code>Function</code> is the parent of all functions, and all functions can be found through <code>__proto__</code>.</li>
<li>The <code>constructor</code> of all <code>ordinary objects</code> created using literal notation is <code>Object</code>.</li>
<li>All <code>prototype objects</code> are <code>ordinary objects</code>, and their constructor is <code>Object</code>.</li>
<li>The <code>constructor of all functions</code> is <code>Function</code>.</li>
<li><code>Function.prototype</code> and <code>Object.prototype</code> do not have prototype objects.</li>
<li><code>Function.prototype</code> and <code>Object.prototype</code> are two special objects created by the <code>engine</code>. Other than these two special objects, all other objects are created using the <code>new</code> constructor.</li>
<li>A function&#39;s <code>prototype</code> is an <code>object</code>, also known as a <code>prototype</code>. </li>
<li>An <code>object&#39;s __proto__</code> points to its prototype. <code>__proto__</code> connects the object and the prototype to form a prototype chain.</li>
<li><code>Function.prototype.__proto__ === Object.prototype</code></li>
<li><code>Object.__proto__ === Function.prototype</code></li>
<li><code>Function.__proto__ === Function.prototype</code></li>
<li><code>Function.__proto__ === Object.__prototype</code></li>
<li><code>Object.prototype.__proto__ === null</code></li>
<li><code>Object =&gt; Function.prototype =&gt; Object.prototype =&gt; null</code></li>
<li><code>Function =&gt; Function.prototype =&gt; Object.prototype =&gt; null</code></li>
<li>For a custom constructor, the prototype chain is as follows: <code>Foo =&gt; Function.prototype =&gt; Object.prototype =&gt; null</code></li>
<li>For an object instantiated using a custom constructor, the prototype chain is as follows: <code>obj =&gt; Foo.prototype =&gt; Object.prototype =&gt; null</code></li>
</ul>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example13.9kgayqd9yw.webp" alt="example13"></p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example14.7snc3ttx2r.webp" alt="example14"></p>
<h2 id="Built-in-Type-Construction-Process"><a href="#Built-in-Type-Construction-Process" class="headerlink" title="Built-in Type Construction Process"></a>Built-in Type Construction Process</h2><p>The <code>JavaScript</code> built-in type is built into the browser kernel. The browser&#39;s underlying <code>JavaScript</code> implementation is based on <code>C/C++</code>. So, what happens when the browser initializes the <code>JavaScript</code> environment?</p>
<ul>
<li>Use <code>C/C++</code> to construct internal data structures, create an <code>OP</code> (Object.prototype), and initialize its internal properties but not its behavior.</li>
<li>Use <code>C/C++</code> to construct internal data structures, create a <code>FP</code> (Function.prototype), and initialize its internal properties but not its behavior.</li>
<li>Set <code>FP</code>&#39;s <code>[[Prototype]]</code> to point to <code>OP</code>.</li>
<li>Use <code>C/C++</code> to construct internal data structures, create various built-in reference types.</li>
<li>Set each built-in reference type&#39;s <code>[[Prototype]]</code> to point to <code>FP</code>.</li>
<li>Set <code>Function</code>&#39;s <code>prototype</code> to point to <code>FP</code>.</li>
<li>Set <code>Object</code>&#39;s <code>prototype</code> to point to <code>OP</code>.</li>
<li>Use <code>Function</code> to instantiate <code>OP</code>, <code>FP</code>, and <code>Object</code>&#39;s behavior and attach them.</li>
<li>Use <code>Object</code> to instantiate <code>prototype</code> property objects for built-in reference types other than <code>Object</code> and <code>Function</code>.</li>
<li>Use <code>Function</code> to create <code>Prototype</code> property objects for built-in reference types other than <code>Object</code> and <code>Function</code>. Instantiate and mount the <code>prototype</code> property of all built-in reference types except <code>Object</code> and <code>Function</code>.</li>
<li>Instantiate the built-in objects <code>Math</code> and <code>Grobal</code>. All built-in types are now constructed.</li>
</ul>
<h1 id="Prototype-Pollution"><a href="#Prototype-Pollution" class="headerlink" title="Prototype Pollution"></a>Prototype Pollution</h1><p><code>Lodash</code> was previously exposed to a serious security vulnerability: <a href="https://link.juejin.cn/?target=https://mp.weixin.qq.com/s/tfZq2PZylGfMjOp8h8eeTw" title="https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;tfZq2PZylGfMjOp8h8eeTw">Lodash library exposed a serious security vulnerability, affecting over 4 million projects</a> </p>
<p>This vulnerability was caused by prototype pollution. The <code>defaultsDeep</code> function in the <code>Lodash</code> library could be tricked into adding or modifying properties of <code>Object.prototype</code>, potentially causing web applications to crash or alter their behavior, depending on the affected use case.</p>
<p>While any prototype pollution can cause issues, prototype pollution generally refers to pollution of <code>Object.prototype</code>.</p>
<h2 id="Harm-of-Prototype-Pollution"><a href="#Harm-of-Prototype-Pollution" class="headerlink" title="Harm of Prototype Pollution"></a>Harm of Prototype Pollution</h2><p>Performance Issues: Prototype pollution increases the number of traversals. Every access to a property that doesn&#39;t exist on the object itself also requires accessing the polluted property on the prototype.</p>
<p>Leading to unexpected logic bugs: See the following example from another expert&#39;s article.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = (<span class="params">obj</span>) =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">      <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clone</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constants</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8080</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> admin = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/signup&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">  <span class="keyword">var</span> copybody = <span class="title function_">clone</span>(body);</span><br><span class="line">  <span class="keyword">if</span> (copybody.<span class="property">name</span>) &#123;</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&#x27;name&#x27;</span>, copybody.<span class="property">name</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">done</span>: <span class="string">&#x27;cookie set&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">error</span>: <span class="string">&#x27;cookie not set&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/getFlag&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> аdmin = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">cookies</span>));</span><br><span class="line">  <span class="keyword">if</span> (admin.аdmin == <span class="number">1</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hackim19&#123;&#125;&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;You are not authorized&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="variable constant_">HOST</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Running on http://<span class="subst">$&#123;HOST&#125;</span>:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<p>这段代码的漏洞就在于 <code>merge</code> 函数上，可以这样攻击：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -vv --header <span class="string">&#x27;Content-type: application/json&#x27;</span> -d <span class="string">&#x27;&#123;&quot;__proto__&quot;: &#123;&quot;admin&quot;: 1&#125;&#125;&#x27;</span> <span class="string">&#x27;http://127.0.0.1:4000/signup&#x27;</span>;</span><br><span class="line"></span><br><span class="line">curl -vv <span class="string">&#x27;http://127.0.0.1/getFlag&#x27;</span></span><br></pre></td></tr></table></figure>

<p>First, a request to the <code>/signup</code> endpoint invoked the vulnerable <code>merge</code> method in the <code>NodeJS</code> service. The <code>__proto__</code> method then added a new property, <code>admin</code>, with a value of <code>1</code>, to <code>Object.prototype</code> (because <code>&#123;&#125;.__proto__ === Object.prototype</code>).</p>
<p>The <code>getFlag</code> endpoint was then called to access the <code>admin</code> property on the <code>Object</code> prototype. The conditional statement <code>admin.add_flag == 1</code> was true, thus exposing the service to the attack.</p>
<h2 id="Preventing-Prototype-Pollution"><a href="#Preventing-Prototype-Pollution" class="headerlink" title="Preventing Prototype Pollution"></a>Preventing Prototype Pollution</h2><p>In practice, prototype pollution mostly occurs when calling functions that modify or extend object properties, such as <code>Lodash</code>&#39;s <code>defaults</code> and <code>jQuery</code>&#39;s <code>extend</code>. </p>
<p>Preventing prototype pollution is primarily about being aware of the problem and developing good coding habits.</p>
<h3 id="Object-create-null"><a href="#Object-create-null" class="headerlink" title="Object.create(null)"></a>Object.create(null)</h3><p><code>Object.create(null)</code> creates an object without a prototype. Even setting <code>__proto__</code> on it is useless because its prototype is initially <code>null</code> and has no <code>__proto__</code> setter.</p>
<p><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/example15.9gwp10k78j.webp" alt="example15"></p>
<h3 id="Object-freeze-obj"><a href="#Object-freeze-obj" class="headerlink" title="Object.freeze(obj)"></a>Object.freeze(obj)</h3><p><code>Object.freeze(obj)</code> freezes an object <code>obj</code>. A frozen object cannot have its properties modified, making it non-extendable. Do not modify or extend an object&#39;s prototype; otherwise, a TypeError will be thrown:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">freeze</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;xiaoHong&#x27;</span> &#125;);</span><br><span class="line">obj.<span class="property">xxx</span> = <span class="number">666</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// =&gt; &#123; name: &#x27;xiaoHong&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(obj)); <span class="comment">// =&gt; false</span></span><br><span class="line">obj.<span class="property">__proto__</span> = <span class="literal">null</span>; <span class="comment">// =&gt; TypeError: #&lt;Object&gt; is not extensible</span></span><br></pre></td></tr></table></figure>

<p>For more information on prototype pollution, please read: <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903887686598663">What You Must Know About JavaScript Behind the Serious Lodash Security Vulnerability</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://donnapersonal.github.io">Donna Tang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://donnapersonal.github.io/posts/jsbasic-prototype/">https://donnapersonal.github.io/posts/jsbasic-prototype/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JS/">JS</a></div><div class="post-share"><div class="social-share" data-image="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.73ubpkycwk.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/jsbasic-handwriting/" title="JavaScript Basic - High-frequency handwriting"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.9ddc96s40g.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">JavaScript Basic - High-frequency handwriting</div></div><div class="info-2"><div class="info-item-1">Simulating Object.is()Object.is() fixes the two edge cases that === does not handle well:  It distinguishes between +0 and -0. It considers NaN equal to itself.  12345678910function objectIs(x, y) &#123;  if (x === y) &#123;    // If both x and y are 0, check for +0 vs -0.    // 1 / +0 = +Infinity, 1 / -0 = -Infinity    return x !== 0 || y !== 0 || 1 / x === 1 / y;  &#125; else &#123;    // Handle NaN: since NaN !== NaN, we check x !== x to detect NaN; y is the same.    return x !== x &amp;&a...</div></div></div></a><a class="pagination-related" href="/posts/jsbasic-inherit/" title="JavaScript Basic - Inheritance"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.2rvii9f6z2.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">JavaScript Basic - Inheritance</div></div><div class="info-2"><div class="info-item-1">InheritanceThe purpose of prototypes is to form the prototype chain:   Reference types are all objects, and each object has a prototype.  Prototypes are also objects, and they also have their own prototypes, forming a prototype chain layer by layer.  The purpose of the prototype chain is inheritance:   When accessing an object&#39;s properties, if the property cannot be found in the object itself, the search is performed up the prototype chain layer by layer.  In other words, one object can a...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/+operator/" title="What are the results of JS&#39;s {} + {} and {} + []?"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.8s3omkauw3.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">What are the results of JS&#39;s {} + {} and {} + []?</div></div><div class="info-2"><div class="info-item-1">PrefaceIn JavaScript, the + symbol is very common and can be used in the following ways:  Addition of numbers (binary operator) String concatenation (binary operator, with the highest precedence) Unary plus, which can also be extended to mean forcing the operand to be converted into a numeric type  Another common syntax element is the curly braces &#123;&#125;, which also have two frequent uses:  Object literal definition Block statements  Plus Operator +In addition to the common cases mentio...</div></div></div></a><a class="pagination-related" href="/posts/jsbasic-datatype/" title="JavaScript Basic - Data Types, Operators, Type Conversion"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.7i0rgcc8cp.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">JavaScript Basic - Data Types, Operators, Type Conversion</div></div><div class="info-2"><div class="info-item-1">Primitive TypesPrimitive values are often referred to as stack data (once a &quot;room&quot; is allocated, the value inside that room cannot be modified). In JavaScript, the following primitive types exist:  number (typeof 1 === &quot;number&quot;) string (typeof &#39;&#39; === &quot;string&quot;) boolean (typeof true === &quot;boolean&quot;) null (typeof null === &quot;object&quot;) undefined (typeof undefined === &quot;undefined&quot;) symbol (typeof Symbol() === &quot;symbol&quot;) bigInt ...</div></div></div></a><a class="pagination-related" href="/posts/0.1+0.2/" title="Why 0.1 + 0.2 !&#x3D; 0.3?"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.6m494gp9dv.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">Why 0.1 + 0.2 !&#x3D; 0.3?</div></div><div class="info-2"><div class="info-item-1">BackgroundWhen you enter the following lines in the browser console, the result is unexpected: 1230.1 + 0.2 &gt; 0.3  // true0.1 + 0.2 = 0.300000000000000040.1 * 0.1 = 0.010000000000000002  Prerequisite KnowledgeIn the world of computers, everything is ultimately binary — just 0s and 1s. To represent common decimal numbers, a conversion process is required. Converting Decimal to BinaryThe overall conversion process from decimal to binary is as follows:  Integer part: divide by 2 and record th...</div></div></div></a><a class="pagination-related" href="/posts/jsbasic-handwriting/" title="JavaScript Basic - High-frequency handwriting"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.9ddc96s40g.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-09</div><div class="info-item-2">JavaScript Basic - High-frequency handwriting</div></div><div class="info-2"><div class="info-item-1">Simulating Object.is()Object.is() fixes the two edge cases that === does not handle well:  It distinguishes between +0 and -0. It considers NaN equal to itself.  12345678910function objectIs(x, y) &#123;  if (x === y) &#123;    // If both x and y are 0, check for +0 vs -0.    // 1 / +0 = +Infinity, 1 / -0 = -Infinity    return x !== 0 || y !== 0 || 1 / x === 1 / y;  &#125; else &#123;    // Handle NaN: since NaN !== NaN, we check x !== x to detect NaN; y is the same.    return x !== x &amp;&a...</div></div></div></a><a class="pagination-related" href="/posts/jsbasic-inherit/" title="JavaScript Basic - Inheritance"><img class="cover" src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.2rvii9f6z2.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-08</div><div class="info-item-2">JavaScript Basic - Inheritance</div></div><div class="info-2"><div class="info-item-1">InheritanceThe purpose of prototypes is to form the prototype chain:   Reference types are all objects, and each object has a prototype.  Prototypes are also objects, and they also have their own prototypes, forming a prototype chain layer by layer.  The purpose of the prototype chain is inheritance:   When accessing an object&#39;s properties, if the property cannot be found in the object itself, the search is performed up the prototype chain layer by layer.  In other words, one object can a...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Donna Tang</div><div class="author-info-description">Learn more! Think more! Do more!</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/donnapersonal"><i class="fab fa-github"></i><span>GitHub</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog! <br>Migrating from old blog!</br></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Constructor-Functions"><span class="toc-number">1.</span> <span class="toc-text">Constructor Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-a-Constructor-Function"><span class="toc-number">1.1.</span> <span class="toc-text">What is a Constructor Function?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Is-Symbol-a-Constructor"><span class="toc-number">1.2.</span> <span class="toc-text">Is Symbol a Constructor?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Is-the-constructor-Value-Read-Only"><span class="toc-number">1.3.</span> <span class="toc-text">Is the constructor Value Read-Only?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simulating-new"><span class="toc-number">1.4.</span> <span class="toc-text">Simulating new</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extension-How-to-Ensure-a-Constructor-Can-Only-Be-Called-with-new-and-Not-as-a-Regular-Function"><span class="toc-number">1.5.</span> <span class="toc-text">Extension: How to Ensure a Constructor Can Only Be Called with new and Not as a Regular Function?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extension-Since-Class-Must-Be-Called-with-new-What-Is-the-Purpose-of-new-target"><span class="toc-number">1.6.</span> <span class="toc-text">Extension: Since Class Must Be Called with new, What Is the Purpose of new.target?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Function-Objects-and-Ordinary-Objects"><span class="toc-number">2.</span> <span class="toc-text">Function Objects and Ordinary Objects</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Prototype-prototype"><span class="toc-number">3.</span> <span class="toc-text">Prototype (prototype)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Concept"><span class="toc-number">3.1.</span> <span class="toc-text">Concept</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#constructor-NaN"><span class="toc-number">3.2.</span> <span class="toc-text">constructor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proto"><span class="toc-number">3.3.</span> <span class="toc-text">proto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object-create"><span class="toc-number">3.4.</span> <span class="toc-text">Object.create()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Simulating-Object-create"><span class="toc-number">3.4.1.</span> <span class="toc-text">Simulating Object.create</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Prototype-Chain"><span class="toc-number">4.</span> <span class="toc-text">Prototype Chain</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Concept-1"><span class="toc-number">4.1.</span> <span class="toc-text">Concept</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Property-Access-Modification-on-the-Prototype-Chain"><span class="toc-number">4.2.</span> <span class="toc-text">Property Access &amp; Modification on the Prototype Chain</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#instanceof-Operator"><span class="toc-number">5.</span> <span class="toc-text">instanceof Operator</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Concept-2"><span class="toc-number">5.1.</span> <span class="toc-text">Concept</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simulating-instanceof"><span class="toc-number">5.2.</span> <span class="toc-text">Simulating instanceof()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Object-Function"><span class="toc-number">6.</span> <span class="toc-text">Object &amp; Function</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Object-prototype"><span class="toc-number">6.1.</span> <span class="toc-text">Object.prototype</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function-prototype"><span class="toc-number">6.2.</span> <span class="toc-text">Function.prototype</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object"><span class="toc-number">6.3.</span> <span class="toc-text">Object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function"><span class="toc-number">6.4.</span> <span class="toc-text">Function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Chicken-Egg-Paradox"><span class="toc-number">6.5.</span> <span class="toc-text">The Chicken &amp; Egg Paradox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Key-Takeaways"><span class="toc-number">6.6.</span> <span class="toc-text">Key Takeaways</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Built-in-Type-Construction-Process"><span class="toc-number">6.7.</span> <span class="toc-text">Built-in Type Construction Process</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Prototype-Pollution"><span class="toc-number">7.</span> <span class="toc-text">Prototype Pollution</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Harm-of-Prototype-Pollution"><span class="toc-number">7.1.</span> <span class="toc-text">Harm of Prototype Pollution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preventing-Prototype-Pollution"><span class="toc-number">7.2.</span> <span class="toc-text">Preventing Prototype Pollution</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Object-create-null"><span class="toc-number">7.2.1.</span> <span class="toc-text">Object.create(null)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Object-freeze-obj"><span class="toc-number">7.2.2.</span> <span class="toc-text">Object.freeze(obj)</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/undefined/" title="map_parseint">map_parseint</a><time datetime="2025-10-02T21:58:42.000Z" title="Created 2025-10-02 17:58:42">2025-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/jsbasic-handwriting/" title="JavaScript Basic - High-frequency handwriting"><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.9ddc96s40g.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaScript Basic - High-frequency handwriting"/></a><div class="content"><a class="title" href="/posts/jsbasic-handwriting/" title="JavaScript Basic - High-frequency handwriting">JavaScript Basic - High-frequency handwriting</a><time datetime="2021-07-10T01:10:53.000Z" title="Created 2021-07-09 21:10:53">2021-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/jsbasic-inherit/" title="JavaScript Basic - Inheritance"><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.2rvii9f6z2.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaScript Basic - Inheritance"/></a><div class="content"><a class="title" href="/posts/jsbasic-inherit/" title="JavaScript Basic - Inheritance">JavaScript Basic - Inheritance</a><time datetime="2021-07-09T01:10:53.000Z" title="Created 2021-07-08 21:10:53">2021-07-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/jsbasic-prototype/" title="JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance"><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.73ubpkycwk.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance"/></a><div class="content"><a class="title" href="/posts/jsbasic-prototype/" title="JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance">JavaScript Basic - Re-understanding constructors, prototypes, prototype chains, and inheritance</a><time datetime="2021-07-09T01:10:53.000Z" title="Created 2021-07-08 21:10:53">2021-07-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/0.1+0.2/" title="Why 0.1 + 0.2 != 0.3?"><img src="https://github.com/donnapersonal/picx-images-hosting/raw/master/image.6m494gp9dv.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Why 0.1 + 0.2 != 0.3?"/></a><div class="content"><a class="title" href="/posts/0.1+0.2/" title="Why 0.1 + 0.2 != 0.3?">Why 0.1 + 0.2 != 0.3?</a><time datetime="2021-05-17T01:35:51.000Z" title="Created 2021-05-16 21:35:51">2021-05-16</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2025 By Donna Tang</span></div><div class="footer_custom_text">Hi, welcome to my blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script data-pjax src="/self/btf.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404') : window.location.href = '/404')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>